<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Volvo Bets — Exchange</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Header / Nav -->
  <header>
    <div class="container top">
      <div class="brand">
        <img src="photo_2025-08-10 09.58.49.jpeg" alt="Volvo Bets">
        <span>VOLVO BETS</span>
      </div>
      <div class="actions">
        <span class="badge">Balance: <strong id="bal">1000</strong> coins</span>
        <a class="btn" href="account.html">Account</a>
        <a class="btn primary" href="index.html">Exchange</a>
      </div>
    </div>
    <div class="container nav">
      <a class="tab active" href="index.html">In-Play</a>
      <a class="tab" href="markets.html">Markets</a>
      <a class="tab" href="rules.html">Rules</a>
      <a class="tab" href="responsible.html">Responsible Gaming</a>
    </div>
  </header>

  <!-- Layout -->
  <div class="container layout">
    <!-- Sidebar -->
    <aside class="panel sidebar">
      <h3>Sports</h3>
      <nav class="menu">
        <a class="active" href="#">Cricket</a>
        <a href="#">Football</a>
        <a href="#">Tennis</a>
      </nav>
      <h3 style="margin-top:14px">Tournaments</h3>
      <div class="menu">
        <a href="#">Asia Cup</a>
        <a href="#">IPL</a>
        <a href="#">La Liga</a>
      </div>
    </aside>

    <!-- Center: Market View -->
    <main class="panel markets">
      <div class="searchbar">
        <input type="search" placeholder="Search events or teams…" oninput="filterEvents(this.value)">
      </div>

      <section class="event">
        <h2 id="matchTitle">Loading…</h2>
        <div class="meta" id="matchMeta">Fetching data…</div>
      </section>

      <section class="event" style="padding-top:0">
        <table aria-label="runner odds grid">
          <thead>
            <tr style="background:transparent">
              <th>Runner</th>
              <th colspan="3" style="text-align:center">Back</th>
              <th colspan="3" style="text-align:center">Lay</th>
            </tr>
          </thead>
          <tbody id="runnerRows"></tbody>
        </table>
      </section>

      <section class="event">
        <h2>Top Markets</h2>
        <div class="meta">Correct Score • Over/Under • 1st Over Runs (demo)</div>
      </section>
    </main>

    <!-- Right: Betslip -->
    <aside class="panel betslip">
      <h3>Bet Slip</h3>
      <div id="bets"></div>
      <div class="total"><span>Total Stake</span><strong id="stakeTotal">0</strong></div>
      <div class="total"><span>Potential Return</span><strong id="retTotal">0</strong></div>
      <button class="btn primary" onclick="placeAll()">Place Bets (Demo)</button>
      <p style="color:var(--muted);font-size:12px">
        Demo UI with virtual coins. Real-money systems require licensing, KYC, and compliance.
      </p>
    </aside>
  </div>

  <!-- Footer -->
  <footer>
    <div class="container links">
      <a href="https://instagram.com/" target="_blank" rel="noopener">Instagram</a>
      <a href="https://t.me/" target="_blank" rel="noopener">Telegram</a>
      <a href="mailto:contact@volvobets.com">Email</a>
    </div>
    <div class="container">© <span id="year"></span> Volvo Bets • Demo with virtual coins</div>
  </footer>

  <!-- App Script -->
  <script>
    // Elements
    const runnerRows = document.getElementById('runnerRows');
    const betsEl     = document.getElementById('bets');
    const stakeTotal = document.getElementById('stakeTotal');
    const retTotal   = document.getElementById('retTotal');
    const balEl      = document.getElementById('bal');
    const matchTitle = document.getElementById('matchTitle');
    const matchMeta  = document.getElementById('matchMeta');

    // State
    let balance = Number(localStorage.vbBal || 1000);
    let betSlip = [];
    let runners = []; // populated from JSON

    if (balEl) balEl.textContent = balance;
    document.getElementById('year').textContent = new Date().getFullYear();

    // ========== DATA LOADING FROM JSON ==========
    async function loadData(){
      try{
        const res = await fetch('data/matches.json', { cache: 'no-store' });
        const matches = await res.json();

        // For now show the first match from JSON
        const m = matches[0];

        // Heading/meta
        matchTitle.textContent = `${m.match} — Match Odds`;
        const t = new Date(m.start);
        const time = t.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        matchMeta.textContent = `${m.sport} • Starts ${time} • In-Play available`;

        // Convert JSON -> current table format
        runners = m.markets["Match Odds"].map(r => ({
          name: r.runner, back: r.back, lay: r.lay
        }));

        renderRunners(runners);
      }catch(err){
        matchTitle.textContent = 'Failed to load match';
        matchMeta.textContent  = 'Check data/matches.json';
        console.error(err);
      }
    }

    // Auto refresh every 10s
    loadData();
    setInterval(loadData, 10000);

    // ========== RENDER TABLE + BETSLIP ==========
    function renderRunners(list){
      runnerRows.innerHTML = '';
      list.forEach((r,ri)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="runner"><span class="chip">Match Odds</span> ${r.name}</td>
          ${r.back.map((p,i)=>`<td><div class="price back${i+1}" onclick="addBet(${ri}, 'back', ${p})">${p.toFixed(2)}</div></td>`).join('')}
          ${r.lay.map((p,i)=>`<td><div class="price lay${i+1}" onclick="addBet(${ri}, 'lay', ${p})">${p.toFixed(2)}</div></td>`).join('')}
        `;
        runnerRows.appendChild(tr);
      });
    }

    function filterEvents(q){ console.log('search:', q); }

    function addBet(index, side, price){
      const r = runners[index];
      betSlip.push({ name:r.name, side, price, stake:0 });
      renderBets();
    }

    function renderBets(){
      betsEl.innerHTML = '';
      let s = 0, r = 0;
      betSlip.forEach((b,i)=>{
        const box = document.createElement('div');
        box.className = 'bet';
        box.innerHTML = `
          <h4>${b.name}</h4>
          <div class="row">
            <span class="tag ${b.side}">${b.side.toUpperCase()} @ ${b.price.toFixed(2)}</span>
            <input type="number" min="0" step="10" placeholder="Stake" value="${b.stake}" oninput="updStake(${i}, this.value)">
            <button class="btn" onclick="removeBet(${i})">✕</button>
          </div>
          <div class="total"><span>Potential Return</span><strong>${(b.stake*b.price).toFixed(2)}</strong></div>
        `;
        betsEl.appendChild(box);
        s += Number(b.stake||0);
        r += (b.stake*b.price)||0;
      });
      stakeTotal.textContent = s.toFixed(2);
      retTotal.textContent   = r.toFixed(2);
    }

    function updStake(i,v){ betSlip[i].stake = Number(v); renderBets(); }
    function removeBet(i){ betSlip.splice(i,1); renderBets(); }

    function placeAll(){
      const total = betSlip.reduce((x,b)=> x + (Number(b.stake)||0), 0);
      if(total<=0) return alert('Add stake.');
      if(total>balance) return alert('Not enough coins.');
      balance -= total; localStorage.vbBal = balance; if(balEl) balEl.textContent = balance;
      alert('Demo: Bets placed!');
      betSlip = []; renderBets();
    }
  </script>
</body>
</html>
